<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Performance Benchmarking Test</title>
    <!-- Adaptive favicon for light/dark mode -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .metric-card {
        display: inline-block;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 15px;
        margin: 10px;
        min-width: 200px;
        text-align: center;
      }
      .metric-value {
        font-size: 24px;
        font-weight: bold;
        margin: 10px 0;
      }
      .metric-good {
        color: #28a745;
      }
      .metric-needs-improvement {
        color: #ffc107;
      }
      .metric-poor {
        color: #dc3545;
      }
      .test-result {
        padding: 10px;
        margin: 5px 0;
        border-radius: 4px;
        font-weight: bold;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .test-button {
        display: inline-block;
        margin: 5px;
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .test-button:hover {
        background-color: #0056b3;
      }
      .page-test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .page-test-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        background: #f8f9fa;
      }
      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-fill {
        height: 100%;
        background-color: #007bff;
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <h1>‚ö° Performance Benchmarking Test</h1>
    <p>Comprehensive performance testing for zen-home marketing integration</p>

    <div class="test-container">
      <h2>üìä Core Web Vitals</h2>
      <div id="web-vitals-container">
        <div class="metric-card">
          <h4>LCP (Largest Contentful Paint)</h4>
          <div id="lcp-value" class="metric-value">Measuring...</div>
          <div>Target: &lt; 2.5s</div>
        </div>
        <div class="metric-card">
          <h4>FID (First Input Delay)</h4>
          <div id="fid-value" class="metric-value">Measuring...</div>
          <div>Target: &lt; 100ms</div>
        </div>
        <div class="metric-card">
          <h4>CLS (Cumulative Layout Shift)</h4>
          <div id="cls-value" class="metric-value">Measuring...</div>
          <div>Target: &lt; 0.1</div>
        </div>
        <div class="metric-card">
          <h4>TTFB (Time to First Byte)</h4>
          <div id="ttfb-value" class="metric-value">Measuring...</div>
          <div>Target: &lt; 600ms</div>
        </div>
      </div>
    </div>

    <div class="test-container">
      <h2>üöÄ Page Load Performance</h2>
      <div id="performance-results"></div>
      <button class="test-button" onclick="runPerformanceTests()">üîç Test All Pages</button>
      <div id="test-progress">
        <div class="progress-bar">
          <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div id="progress-text">Ready to start testing...</div>
      </div>
    </div>

    <div class="test-container">
      <h2>üìà Performance Metrics</h2>
      <div id="detailed-metrics"></div>
    </div>

    <div class="test-container">
      <h2>üéØ Performance Recommendations</h2>
      <div id="recommendations"></div>
    </div>

    <script>
      const performanceResults = document.getElementById('performance-results');
      const detailedMetrics = document.getElementById('detailed-metrics');
      const recommendations = document.getElementById('recommendations');
      const progressFill = document.getElementById('progress-fill');
      const progressText = document.getElementById('progress-text');

      // Pages to test
      const testPages = [
        { path: '/', name: 'Homepage', priority: 'high' },
        { path: '/solutions', name: 'Solutions', priority: 'high' },
        { path: '/contact', name: 'Contact', priority: 'medium' },
        { path: '/guides', name: 'Prompting Guide', priority: 'medium' },

        {
          path: '/services/digital-transformation',
          name: 'Digital Transformation',
          priority: 'medium',
        },
        { path: '/dashboard', name: 'Dashboard', priority: 'high' },
      ];

      function addResult(message, type = 'success') {
        const div = document.createElement('div');
        div.className = `test-result ${type}`;
        div.textContent = message;
        performanceResults.appendChild(div);
      }

      function updateProgress(current, total, message) {
        const percentage = (current / total) * 100;
        progressFill.style.width = `${percentage}%`;
        progressText.textContent = message;
      }

      function formatTime(ms) {
        if (ms < 1000) return `${Math.round(ms)}ms`;
        return `${(ms / 1000).toFixed(2)}s`;
      }

      function getPerformanceRating(value, thresholds) {
        if (value <= thresholds.good) return 'good';
        if (value <= thresholds.needsImprovement) return 'needs-improvement';
        return 'poor';
      }

      async function measurePagePerformance(url) {
        const startTime = performance.now();

        try {
          const response = await fetch(url);
          const endTime = performance.now();
          const loadTime = endTime - startTime;

          return {
            success: true,
            loadTime,
            status: response.status,
            size: response.headers.get('content-length') || 'unknown',
          };
        } catch (error) {
          return {
            success: false,
            error: error.message,
            loadTime: performance.now() - startTime,
          };
        }
      }

      async function runPerformanceTests() {
        performanceResults.innerHTML = '';
        addResult('üöÄ Starting performance benchmarking...', 'warning');

        let totalLoadTime = 0;
        let successCount = 0;
        let errorCount = 0;

        for (let i = 0; i < testPages.length; i++) {
          const page = testPages[i];
          updateProgress(i, testPages.length, `Testing ${page.name}...`);

          const result = await measurePagePerformance(`http://localhost:3001${page.path}`);

          if (result.success) {
            const rating = getPerformanceRating(result.loadTime, {
              good: 1000,
              needsImprovement: 2500,
            });

            addResult(
              `‚úÖ ${page.name} - ${formatTime(result.loadTime)} (${rating})`,
              rating === 'good' ? 'success' : rating === 'needs-improvement' ? 'warning' : 'error'
            );

            totalLoadTime += result.loadTime;
            successCount++;
          } else {
            addResult(`‚ùå ${page.name} - Error: ${result.error}`, 'error');
            errorCount++;
          }
        }

        updateProgress(testPages.length, testPages.length, 'Performance testing completed!');

        // Summary
        const avgLoadTime = totalLoadTime / successCount;
        addResult(
          `üìä Average Load Time: ${formatTime(avgLoadTime)}`,
          avgLoadTime < 1000 ? 'success' : 'warning'
        );
        addResult(
          `üìä Success Rate: ${successCount}/${testPages.length} pages`,
          errorCount === 0 ? 'success' : 'warning'
        );

        generateRecommendations(avgLoadTime, successCount, errorCount);
      }

      function generateRecommendations(avgLoadTime, successCount, errorCount) {
        recommendations.innerHTML = '';

        const recDiv = document.createElement('div');

        if (avgLoadTime > 2500) {
          recDiv.innerHTML +=
            '<div class="test-result error">‚ö†Ô∏è Average load time exceeds 2.5s - Consider optimizing images and code splitting</div>';
        } else if (avgLoadTime > 1000) {
          recDiv.innerHTML +=
            '<div class="test-result warning">üí° Load times could be improved - Consider image optimization and caching</div>';
        } else {
          recDiv.innerHTML +=
            '<div class="test-result success">‚úÖ Excellent load times - Performance is optimal</div>';
        }

        if (errorCount > 0) {
          recDiv.innerHTML +=
            '<div class="test-result error">üîß Some pages failed to load - Check routing and server configuration</div>';
        }

        // General recommendations
        recDiv.innerHTML +=
          '<div class="test-result warning">üí° Consider implementing service worker for offline support</div>';
        recDiv.innerHTML +=
          '<div class="test-result warning">üí° Monitor Core Web Vitals in production with real user data</div>';

        recommendations.appendChild(recDiv);
      }

      // Web Vitals measurement (simplified version)
      function measureWebVitals() {
        // LCP measurement
        if ('PerformanceObserver' in window) {
          try {
            const lcpObserver = new PerformanceObserver((list) => {
              const entries = list.getEntries();
              const lastEntry = entries[entries.length - 1];
              const lcpValue = lastEntry.startTime;

              document.getElementById('lcp-value').textContent = formatTime(lcpValue);
              document.getElementById(
                'lcp-value'
              ).className = `metric-value metric-${getPerformanceRating(lcpValue, {
                good: 2500,
                needsImprovement: 4000,
              })}`;
            });
            lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });
          } catch (e) {
            document.getElementById('lcp-value').textContent = 'Not supported';
          }

          // CLS measurement
          try {
            let clsValue = 0;
            const clsObserver = new PerformanceObserver((list) => {
              for (const entry of list.getEntries()) {
                if (!entry.hadRecentInput) {
                  clsValue += entry.value;
                }
              }
              document.getElementById('cls-value').textContent = clsValue.toFixed(3);
              document.getElementById(
                'cls-value'
              ).className = `metric-value metric-${getPerformanceRating(clsValue, {
                good: 0.1,
                needsImprovement: 0.25,
              })}`;
            });
            clsObserver.observe({ entryTypes: ['layout-shift'] });
          } catch (e) {
            document.getElementById('cls-value').textContent = 'Not supported';
          }
        }

        // TTFB measurement
        if (performance.timing) {
          const ttfb = performance.timing.responseStart - performance.timing.navigationStart;
          document.getElementById('ttfb-value').textContent = formatTime(ttfb);
          document.getElementById(
            'ttfb-value'
          ).className = `metric-value metric-${getPerformanceRating(ttfb, {
            good: 600,
            needsImprovement: 1000,
          })}`;
        }

        // FID - simplified (actual measurement requires user interaction)
        document.getElementById('fid-value').textContent = 'Requires interaction';
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        measureWebVitals();

        // Add detailed metrics
        if (performance.timing) {
          const timing = performance.timing;
          const metrics = [
            { name: 'DNS Lookup', value: timing.domainLookupEnd - timing.domainLookupStart },
            { name: 'TCP Connection', value: timing.connectEnd - timing.connectStart },
            { name: 'Request/Response', value: timing.responseEnd - timing.requestStart },
            { name: 'DOM Processing', value: timing.domComplete - timing.domLoading },
            { name: 'Total Load Time', value: timing.loadEventEnd - timing.navigationStart },
          ];

          detailedMetrics.innerHTML = '<h4>Detailed Timing Metrics:</h4>';
          metrics.forEach((metric) => {
            if (metric.value > 0) {
              detailedMetrics.innerHTML += `<div class="test-result success">${
                metric.name
              }: ${formatTime(metric.value)}</div>`;
            }
          });
        }
      });

      // Monitor for layout shifts
      let layoutShiftScore = 0;
      if ('PerformanceObserver' in window) {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (!entry.hadRecentInput) {
              layoutShiftScore += entry.value;
            }
          }
        });
        observer.observe({ entryTypes: ['layout-shift'] });
      }
    </script>
  </body>
</html>
